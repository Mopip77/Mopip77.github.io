---
layout: post
title: Docker重点总结(5) ---- 网络
tags:
- linux
- docker
---

# 端口相关
docker内部的网络应用的端口如果需要暴露到外部，则需要使用-p或-P来暴露(映射)在本机的端口上

当使用 `-P` 标记时，Docker 会随机映射一个 49000~49900 的端口到内部容器开放的网络端口。
`-p` 则可以指定要映射的端口，并且，在一个指定端口上只可以绑定一个容器。支持的格式有 `ip:hostPort:containerPort | ip::containerPort | hostPort:containerPort`

其中`ip::containerPort`是本地的随机端口

如果想使用udp则只需要使用`<映射格式>/udp`即可

当然docker也提供port命令

# docker网络
#### 容器互联
如果你之前有 Docker 使用经验，你可能已经习惯了使用 `--link` 参数来使容器互联。

随着 Docker 网络的完善，强烈建议大家将容器加入自定义的 Docker 网络来连接多个容器，而不是使用 `--link` 参数。

#### 新建网络
```shell
docker network create -d bridge my-net
```

`-d` 参数指定 Docker 网络类型，有 `bridge` `overlay`。其中 overlay 网络类型用于 `Swarm mode`，在本小节中你可以忽略它。

#### 连接容器
运行两个容器并连接到新建的 `my-net` 网络
```shell
docker run -it --rm --name busybox1 --network my-net busybox sh
docker run -it --rm --name busybox2 --network my-net busybox sh
```

我们可以进入`busybox1`容器看看这两个容器是否互联了
```shell
/ # ping busybox2
PING busybox2 (172.19.0.3): 56 data bytes
64 bytes from 172.19.0.3: seq=0 ttl=64 time=0.072 ms
64 bytes from 172.19.0.3: seq=1 ttl=64 time=0.118 ms
```

如果有多个容器需要互联，建议使用docker-compose

#### DNS配置
如果需要和主机同步变化，只需要挂载主机的`/etc/resolv.conf`即可，与此类似`hosts`, `hostname`也可以

也可以在run添加参数
```shell
# 主机名，同一网络应该不能有两个相同的
-h HOSTNAME
--hostname=HOSTNAME

# dns
--dns=IP_ADDRESS
```